!function(){var e={};!function e(t,r,n){function o(c,i){if(!r[c]){if(!t[c]){var u="function"==typeof require&&require;if(!i&&u)return u(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}var s=r[c]={exports:{}};t[c][0].call(s.exports,function(e){var r=t[c][1][e];return o(r||e)},s,s.exports,e,t,r,n)}return r[c].exports}for(var a="function"==typeof require&&require,c=0;c<n.length;c++)o(n[c]);return o}({1:[function(e,t,r){function n(e,t,r){return!0}function o(e,t,r,o){if(e.global)return n(t||j,r,o)}function a(e){e.global&&0==C.active++&&o(e,null,"ajaxStart")}function c(e){e.global&&!--C.active&&o(e,null,"ajaxStop")}function i(e,t){var r=t.context;if(!1===t.beforeSend.call(r,e,t)||!1===o(t,r,"ajaxBeforeSend",[e,t]))return!1;o(t,r,"ajaxSend",[e,t])}function u(e,t,r){var n=r.context;r.success.call(n,e,"success",t),o(r,n,"ajaxSuccess",[t,r,e]),l("success",t,r)}function s(e,t,r,n){var a=n.context;n.error.call(a,r,t,e),o(n,a,"ajaxError",[r,n,e]),l(t,r,n)}function l(e,t,r){var n=r.context;r.complete.call(n,t,e),o(r,n,"ajaxComplete",[t,r]),c(r)}function p(){}function f(e){return e&&(e==q?"html":e==E?"json":T.test(e)?"script":S.test(e)&&"xml")||"text"}function d(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function m(e){"object"===v(e.data)&&(e.data=h(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=d(e.url,e.data))}function g(e,t,r,n){var o="array"===v(t);for(var a in t){var c=t[a];n&&(a=r?n:n+"["+(o?"":a)+"]"),!n&&o?e.add(c.name,c.value):(r?"array"===v(c):"object"===v(c))?g(e,c,r,a):e.add(a,c)}}function h(e,t){var r=[];return r.add=function(e,t){this.push(O(e)+"="+O(t))},g(r,e,t),r.join("&").replace("%20","+")}function x(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){for(b in t)void 0!==t[b]&&(e[b]=t[b])}),e}var v;try{v=e("type-of")}catch(t){v=e("type")}var b,w,y=0,j=window.document,T=/^(?:text|application)\/javascript/i,S=/^(?:text|application)\/xml/i,E="application/json",q="text/html",L=/^\s*$/,C=t.exports=function(e){var t=x({},e||{});for(b in C.settings)void 0===t[b]&&(t[b]=C.settings[b]);a(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&RegExp.$2!=window.location.host);var r=t.dataType,n=/=\?/.test(t.url);if("jsonp"==r||n)return n||(t.url=d(t.url,"callback=?")),C.JSONP(t);t.url||(t.url=window.location.toString()),m(t);var o,c=t.accepts[r],l={},g=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:window.location.protocol,h=C.settings.xhr();t.crossDomain||(l["X-Requested-With"]="XMLHttpRequest"),c&&(l.Accept=c,c.indexOf(",")>-1&&(c=c.split(",",2)[0]),h.overrideMimeType&&h.overrideMimeType(c)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(l["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=x(l,t.headers||{}),h.onreadystatechange=function(){if(4==h.readyState){clearTimeout(o);var e,n=!1;if(h.status>=200&&h.status<300||304==h.status||0==h.status&&"file:"==g){r=r||f(h.getResponseHeader("content-type")),e=h.responseText;try{"script"==r?(0,eval)(e):"xml"==r?e=h.responseXML:"json"==r&&(e=L.test(e)?null:JSON.parse(e))}catch(e){n=e}n?s(n,"parsererror",h,t):u(e,h,t)}else s(null,"error",h,t)}};var v=!("async"in t)||t.async;h.open(t.type,t.url,v);for(w in t.headers)h.setRequestHeader(w,t.headers[w]);return!1===i(h,t)?(h.abort(),!1):(t.timeout>0&&(o=setTimeout(function(){h.onreadystatechange=p,h.abort(),s(null,"timeout",h,t)},t.timeout)),h.send(t.data?t.data:null),h)};C.active=0,C.JSONP=function(e){if(!("type"in e))return C(e);var t,r="jsonp"+ ++y,n=j.createElement("script"),o={abort:function(){r in window&&(window[r]=p),l("abort",o,e)}},a=j.getElementsByTagName("head")[0]||j.documentElement;return e.error&&(n.onerror=function(){o.abort(),e.error()}),window[r]=function(n){clearTimeout(t),delete window[r],u(n,o,e)},m(e),n.src=e.url.replace(/=\?/,"="+r),a.insertBefore(n,a.firstChild),e.timeout>0&&(t=setTimeout(function(){o.abort(),l("timeout",o,e)},e.timeout)),o},C.settings={type:"GET",beforeSend:p,success:p,error:p,complete:p,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:E,xml:"application/xml, text/xml",html:q,text:"text/plain"},crossDomain:!1,timeout:0},C.get=function(e,t){return C({url:e,success:t})},C.post=function(e,t,r,n){return"function"===v(t)&&(n=n||r,r=t,t=null),C({type:"POST",url:e,data:t,success:r,dataType:n})},C.getJSON=function(e,t){return C({url:e,success:t,dataType:"json"})};var O=encodeURIComponent},{"type-of":2}],2:[function(e,t,r){var n=Object.prototype.toString;t.exports=function(e){switch(n.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}},{}]},e,[1]),window.ajax=e[1].exports}(),function(){function e(e,t){r().then(function(r){var n=r.server+"/bugfree/index.php/bug/"+e;if(s.hasOwnProperty(n))return Promise.resolve(s[n]);a(n).then(function(e){s[n]=e,t(e)}).catch(t)})}function t(){var e;return r().then(function(t){return new Promise(function(r,n){e=t.server,ajax({url:t.server+"/bugfree/index.php/bug/list/1?query_id=-2",dataType:"text",success:r,error:n})})}).then(function(e){for(var t,r,n=(new DOMParser).parseFromString(e,"text/html").querySelector("#SearchResultDiv").firstElementChild.rows,o=[],a=[].slice.call(n[0].cells,0),c=1,i=n.length;c<i;c++)t=n[c].cells,r={},a.forEach(function(e,n){t[n]&&("title"===t[n].className?r[e.innerText]=t[n].querySelector("a").getAttribute("title"):r[e.innerText]=t[n].innerText)}),r.hasOwnProperty("ID")&&o.push(r);return o})}function r(){return new Promise(function(e,t){chrome.storage.local.get(u,function(r){r?e(r):t()})})}function n(){var e={"LoginForm[username]":"username","LoginForm[password]":"password"};return r().then(function(t){var r=new FormData;for(var n in e)r.append(n,t[e[n]]);return r.append("LoginForm[language]","zh_cn"),o(t.server+"/bugfree/index.php/site/login",r)})}function o(e,t){return new Promise(function(r,n){var o=new XMLHttpRequest;o.open("POST",e),o.send(t),o.addEventListener("load",function(e){var t=e.target.status,o=e.target.statusText;200===t?r():n(new Error(o))}),o.addEventListener("error",n),o.addEventListener("timeout",n)})}function a(e){return new Promise(function(t,r){ajax({url:e,success:t,error:r})})}var c,i,u=["server","type","username","password"];chrome.runtime.onMessage.addListener(function(t,n,o){switch(t.cmd){case"get-bug-list":o(c||[]);break;case"get-bug-error":o(i||"");break;case"open-bug":r().then(function(e){chrome.tabs.create({url:e.server+"/bugfree/index.php/bug/"+t.id})});break;case"open-bugfree":r().then(function(e){chrome.tabs.create({url:e.server+"/bugfree/index.php/bug/list/1?query_id=-2"})});break;case"bug-detail":return e(t.id,o),!0;case"reload":chrome.runtime.reload();break;case"error":console.error("error from popup:"),console.error(t.error)}}),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&console.log("storage changed:",e)}),n().then(function(){function e(){t().then(function(t){c=t,i=null;var r=t.filter(function(e){return"Local Fix"!==e["处理状态"]}).length,n=0===r?"":r+"";chrome.browserAction.setBadgeText({text:n}),0===r?chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,0]}):chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,255]}),setTimeout(e,18e4)}).catch(function(t){chrome.browserAction.setBadgeText({text:"err"}),chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,255]}),c=[],i=t instanceof XMLHttpRequest?"请求失败":t.toString(),setTimeout(e,18e4)})}e()});var s={}}();